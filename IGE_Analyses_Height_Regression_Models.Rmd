---
title: 'Indirect Genetic Effects: Height Regression Analyses'
author: "Melisa Chuong"
date: "28/01/2021"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Regression analyses exploring IGE in Height  

**ALL VARIABLES ARE STANDARDISED - INTERPRET ACCORDINGLY**  
Meaning as the IV increases by 1 standard deviation, the DV increases by Estimate*SD  
All parent phenotypes are pre-corrected for their own 20 principle components and AGE

A. oHEI ~ oPRS *This model captures direct GE*  
B. oHEI ~ oPRS + mPRS + pPRS *This model captures both direct and indirect GE*  

Models C and D can provide extra information  

C. oHEI ~ oPRS + mHEI + pHEI  
D. oHEI ~ oPRS + mHEI + pHEI + mPRS + pPRS  

Comparison of the models using log likelihood can help us infer whether the effects of indirect genetic effects are present (specifically comparison of model A vs B)  

There are siblings in my trio offsprings. It is important to control for these sibling effects which may bias the interpretation of results. Sibling effects will be fitted as random effects in these models. The package lmerTest will be used. Siblings have the same parent IDs, so we can use this as an indicator variable that can be fixed as random.  

```{r}
rm(list=ls())

library(lmerTest) #this package allows us to run regression models with fixed and random effects
library(MuMIn) #this package allows us to obtain the R2 of our models, R2m (Marginal) R2 > fixed effects, R2c (Conditional) > whole model
library(dplyr)

regdf <- read.table("IGE_height_regression_df", header=T) #n=2648

#Model 0 is to understand the variance that is being accounted for by the covariates 
Model0 <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+SEX+(1|NFID), data=regdf)

#only including results of AGE and SEX as this information is easy to understand and important
results_0 <- cbind(as.data.frame(coef(summary(Model0))[c(1,22,23),]),as.data.frame(r.squaredGLMM(Model0)))
results_0$Model <- "Model0"

ModelA <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+SEX+heiPRS_0.05+(1|NFID), data=regdf)
results_A <- cbind(as.data.frame(coef(summary(ModelA))[c(1,24),]),as.data.frame(r.squaredGLMM(ModelA)))
results_A$Model <- "ModelA"

ModelB <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+SEX+heiPRS_0.05+mheiPRS_0.05+pheiPRS_0.05+(1|NFID), data=regdf)   
results_B <- cbind(as.data.frame(coef(summary(ModelB))[c(1,24:26),]),as.data.frame(r.squaredGLMM(ModelB)))
results_B$Model <- "ModelB"
  
ModelC <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+SEX+heiPRS_0.05+mHEI_res+pHEI_res+(1|NFID), data=regdf)   
results_C <- cbind(as.data.frame(coef(summary(ModelC))[c(1,24:26),]),as.data.frame(r.squaredGLMM(ModelC)))
results_C$Model <- "ModelC"

ModelD <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+SEX+heiPRS_0.05+mheiPRS_0.05+pheiPRS_0.05+mHEI_res+pHEI_res+(1|NFID), data=regdf)   
results_D <- cbind(as.data.frame(coef(summary(ModelD))[c(1,24:28),]),as.data.frame(r.squaredGLMM(ModelD)))
results_D$Model <- "ModelD"

results <- bind_rows(results_0, results_A, results_B, results_C, results_D)
write.csv(results, "heiPRS_0.05_reg_mixed_models.csv", row.names=T, quote=F)

avb <- as.data.frame(anova(ModelA, ModelB))
avb$comparison <- "A_v_B"

avc <- as.data.frame(anova(ModelA, ModelC))
avc$comparison <- "A_v_C"

avd <- as.data.frame(anova(ModelA, ModelD))
avd$comparison <- "A_v_D"

bvc <- as.data.frame(anova(ModelB, ModelC))
bvc$comparison <- "B_v_C"

bvd <- as.data.frame(anova(ModelB, ModelD))
bvd$comparison <- "B_v_D"

cvd <- as.data.frame(anova(ModelC, ModelD))
cvd$comparison <- "C_v_D"

results <- bind_rows(avb, avc, avd, bvc, bvd, cvd)
results[8,8] <- NA
results$fdr <- p.adjust(results$`Pr(>Chisq)`, method="fdr", n=length(results$`Pr(>Chisq)`))
write.csv(results, "heiPRS_0.05_reg_mixed_model_comparison.csv", row.names=T, quote=F)

```
## Regression analyses exploring IGE in Female Height

Even though sex is being controlled for in the above analyses, the analyses will be run separately in male and female offspring to explore any potential differences in the model results and comparisons.

```{r}
rm(list=ls())

library(lmerTest) #this package allows us to run regression models with fixed and random effects
library(MuMIn) #this package allows us to obtain the R2 of our models, R2m (Marginal) R2 > fixed effects, R2c (Conditional) > whole model
library(dplyr)

regdf <- read.table("IGE_height_regression_df", header=T)
regdf <- subset(regdf, regdf$SEX=="F") #n= 1498

#Model 0 is to understand the variance that is being accounted for by the covariates 
Model0 <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+(1|NFID), data=regdf)

#only including results of AGE and SEX as this information is easy to understand and important
results_0 <- cbind(as.data.frame(coef(summary(Model0))[c(1,21,22),]),as.data.frame(r.squaredGLMM(Model0)))
results_0$Model <- "Model0"

ModelA <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+(1|NFID), data=regdf)
results_A <- cbind(as.data.frame(coef(summary(ModelA))[c(1,23),]),as.data.frame(r.squaredGLMM(ModelA)))
results_A$Model <- "ModelA"

ModelB <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+mheiPRS_0.05+pheiPRS_0.05+(1|NFID), data=regdf)   
results_B <- cbind(as.data.frame(coef(summary(ModelB))[c(1,23:25),]),as.data.frame(r.squaredGLMM(ModelB)))
results_B$Model <- "ModelB"
  
ModelC <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+mHEI_res+pHEI_res+(1|NFID), data=regdf)   
results_C <- cbind(as.data.frame(coef(summary(ModelC))[c(1,23:25),]),as.data.frame(r.squaredGLMM(ModelC)))
results_C$Model <- "ModelC"

ModelD <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+mheiPRS_0.05+pheiPRS_0.05+mHEI_res+pHEI_res+(1|NFID), data=regdf)   
results_D <- cbind(as.data.frame(coef(summary(ModelD))[c(1,23:27),]),as.data.frame(r.squaredGLMM(ModelD)))
results_D$Model <- "ModelD"

results <- bind_rows(results_0, results_A, results_B, results_C, results_D)
write.csv(results, "heiPRS_0.05_reg_mixed_models_FEMALE.csv", row.names=T, quote=F)

avb <- as.data.frame(anova(ModelA, ModelB))
avb$comparison <- "A_v_B"

avc <- as.data.frame(anova(ModelA, ModelC))
avc$comparison <- "A_v_C"

avd <- as.data.frame(anova(ModelA, ModelD))
avd$comparison <- "A_v_D"

bvc <- as.data.frame(anova(ModelB, ModelC))
bvc$comparison <- "B_v_C"

bvd <- as.data.frame(anova(ModelB, ModelD))
bvd$comparison <- "B_v_D"

cvd <- as.data.frame(anova(ModelC, ModelD))
cvd$comparison <- "C_v_D"

results <- bind_rows(avb, avc, avd, bvc, bvd, cvd)
results[8,8] <- NA
results$fdr <- p.adjust(results$`Pr(>Chisq)`, method="fdr", n=length(results$`Pr(>Chisq)`))
write.csv(results, "heiPRS_0.05_reg_mixed_model_comparison_FEMALE.csv", row.names=T, quote=F)

```

## Regression analyses exploring IGE in Male Height

```{r}
rm(list=ls())

library(lmerTest) #this package allows us to run regression models with fixed and random effects
library(MuMIn) #this package allows us to obtain the R2 of our models, R2m (Marginal) R2 > fixed effects, R2c (Conditional) > whole model
library(dplyr)

regdf <- read.table("IGE_height_regression_df", header=T)
regdf <- subset(regdf, regdf$SEX=="M") #n= 1150

#Model 0 is to understand the variance that is being accounted for by the covariates 
Model0 <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+(1|NFID), data=regdf)

#only including results of AGE and SEX as this information is easy to understand and important
results_0 <- cbind(as.data.frame(coef(summary(Model0))[c(1,21,22),]),as.data.frame(r.squaredGLMM(Model0)))
results_0$Model <- "Model0"

ModelA <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+(1|NFID), data=regdf)
results_A <- cbind(as.data.frame(coef(summary(ModelA))[c(1,23),]),as.data.frame(r.squaredGLMM(ModelA)))
results_A$Model <- "ModelA"

ModelB <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+mheiPRS_0.05+pheiPRS_0.05+(1|NFID), data=regdf)   
results_B <- cbind(as.data.frame(coef(summary(ModelB))[c(1,23:25),]),as.data.frame(r.squaredGLMM(ModelB)))
results_B$Model <- "ModelB"
  
ModelC <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+mHEI_res+pHEI_res+(1|NFID), data=regdf)   
results_C <- cbind(as.data.frame(coef(summary(ModelC))[c(1,23:25),]),as.data.frame(r.squaredGLMM(ModelC)))
results_C$Model <- "ModelC"

ModelD <- lmer(HEIGHT~C1+C2+C3+C4+C5+C6+C7+C8+C9+C10+C11+C12+C13+C14+C15+C16+C17+C18+C19+C20+AGE+heiPRS_0.05+mheiPRS_0.05+pheiPRS_0.05+mHEI_res+pHEI_res+(1|NFID), data=regdf)   
results_D <- cbind(as.data.frame(coef(summary(ModelD))[c(1,23:27),]),as.data.frame(r.squaredGLMM(ModelD)))
results_D$Model <- "ModelD"

results <- bind_rows(results_0, results_A, results_B, results_C, results_D)
write.csv(results, "heiPRS_0.05_reg_mixed_models_MALE.csv", row.names=T, quote=F)

avb <- as.data.frame(anova(ModelA, ModelB))
avb$comparison <- "A_v_B"

avc <- as.data.frame(anova(ModelA, ModelC))
avc$comparison <- "A_v_C"

avd <- as.data.frame(anova(ModelA, ModelD))
avd$comparison <- "A_v_D"

bvc <- as.data.frame(anova(ModelB, ModelC))
bvc$comparison <- "B_v_C"

bvd <- as.data.frame(anova(ModelB, ModelD))
bvd$comparison <- "B_v_D"

cvd <- as.data.frame(anova(ModelC, ModelD))
cvd$comparison <- "C_v_D"

results <- bind_rows(avb, avc, avd, bvc, bvd, cvd)
results[8,8] <- NA
results$fdr <- p.adjust(results$`Pr(>Chisq)`, method="fdr", n=length(results$`Pr(>Chisq)`))
write.csv(results, "heiPRS_0.05_reg_mixed_model_comparison_MALE.csv", row.names=T, quote=F)

```



